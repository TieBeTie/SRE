# Отчёт о нагрузочном тестировании


Проведено нагрузочное тестирование API приложения для определения максимальной производительности системы и выявления узких мест. Нагрузка подавалась через HTTP запросы к ingress, что соответствует реальному сценарию использования.

## 1. Профиль нагрузки

**Эндпоинты:**
- `GET /Cities/{id}` — 80% запросов
- `GET /Cities` — 20% запросов

**Параметры:**
- Think time: 0.2-0.7 секунд
- Постепенное увеличение нагрузки (ramp-up)

**Скрипты:** `scripts/smoke_test.js`, `scripts/load_test.js`, `scripts/gradual_load_test.js`

## 2. SLO/SLA

| Метрика | SLO | Фактическое |
|---------|-----|-------------|
| Availability | 99.9% | 100% ✅ |
| Latency p95 | < 500ms | 60.75ms ✅ |
| Error Rate | < 0.1% | 0% ✅ |
| Throughput | ≥ 100 RPS | 195 RPS ✅ |

## 3. Максимальная производительность

Проведен тест с нагрузкой 200 виртуальных пользователей в течение 3 минут. Обработано 34,116 запросов, пропускная способность ~195 RPS. Error rate 0%, p95 latency 60.75ms, успешность 99.87%. Все SLO/SLA выполнены. При анализе метрик ingress в Grafana графики показывают только ~42 RPS, что связано с особенностями агрегации метрик ingress, поэтому для оценки производительности использованы данные k6.

## 4. Узкое место

Узким местом системы являются соединения к базе данных PostgreSQL. Во время теста при постепенном повышении нагрузки был зафиксирован пик в 190 активных соединения к БД (см. `reports/screenshots/postgres_active_connections.png`). Максимальная производительность ~195 RPS достигается при максимальной нагрузке на пул соединений.

Использование CPU на всех нодах составило всего 6.5% (см. `reports/screenshots/cpu_usage.png`), что исключает процессор как узкое место. Проблема в ограничениях на уровне пула соединений, а не в ресурсах инфраструктуры.

Конфигурация: 3 реплики API по 0.3 CPU каждая.

## 5. Выводы

Система стабильно работает при нагрузке до 200 VUs, все SLO/SLA выполнены. Узкое место — соединения к PostgreSQL (190 соединения при пике). CPU не является ограничением (6.5% использования). Для масштабирования требуется увеличение лимитов соединений к БД.
